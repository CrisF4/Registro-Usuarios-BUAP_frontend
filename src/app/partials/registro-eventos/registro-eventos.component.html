<div class="wrapper">
  <div class="section-registro">
    <div class="body-registro">
      <div class="row mt-3 mb-3">
        <div class="form-group col-12">
          <label class="title-user" for="tipo_usuario">
            {{ editar ? 'Editar Evento Académico' : 'Registrar Evento Académico' }}
          </label>
        </div>
      </div>

      <!-- Nombre del evento -->
      <mat-form-field class="mat-input" appearance="outline">
        <mat-label>Nombre del evento</mat-label>
        <input matInput [(ngModel)]="evento.nombre_evento" placeholder="Escribe el nombre del evento"
          (keypress)="soloLetrasYNumeros($event)">
      </mat-form-field>
      <div *ngIf="errors.nombre_evento" class="invalid-feedback">{{ errors.nombre_evento }}</div>

      <!-- Tipo de evento -->
      <mat-form-field class="mat-input" appearance="outline">
        <mat-label>Tipo de evento</mat-label>
        <mat-select [(ngModel)]="evento.tipo_evento">
          <mat-option *ngFor="let tipo of tiposEvento" [value]="tipo.value">
            {{ tipo.viewValue }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <div *ngIf="errors.tipo_evento" class="invalid-feedback">{{ errors.tipo_evento }}</div>

      <!-- Fecha de realización -->
      <mat-form-field class="mat-input" appearance="outline">
        <mat-label>Fecha de realización</mat-label>
        <input matInput [matDatepicker]="picker" [(ngModel)]="evento.fecha_realizacion"
          [min]="fechaMinima" placeholder="dd/MM/yyyy" (focus)="picker.open()" (dateChange)="changeFecha($event)" type="string">
        <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>
      <div *ngIf="errors.fecha_realizacion" class="invalid-feedback">{{ errors.fecha_realizacion }}</div>

      <!-- Horario - Hora de inicio (con reloj analógico visual) -->
      <mat-form-field class="mat-input" appearance="outline">
        <mat-label>Hora de inicio</mat-label>
        <input matInput
               [(ngModel)]="evento.hora_inicio"
               [ngxTimepicker]="pickerInicio"
               [format]="24"
               placeholder="Selecciona hora de inicio"
               readonly>
        <mat-icon matSuffix (click)="pickerInicio.open()" (keydown.enter)="pickerInicio.open()" tabindex="0">access_time</mat-icon>
      </mat-form-field>
      <ngx-material-timepicker #pickerInicio
                               [theme]="timePickerTheme"
                               [cancelBtnTmpl]="cancelBtn"
                               [confirmBtnTmpl]="confirmBtn">
      </ngx-material-timepicker>
      <div *ngIf="errors.hora_inicio" class="invalid-feedback">{{ errors.hora_inicio }}</div>

      <!-- Horario - Hora de finalización (con reloj analógico visual) -->
      <mat-form-field class="mat-input" appearance="outline">
        <mat-label>Hora de finalización</mat-label>
        <input matInput
               [(ngModel)]="evento.hora_fin"
               [ngxTimepicker]="pickerFin"
               [format]="24"
               placeholder="Selecciona hora de fin"
               readonly>
        <mat-icon matSuffix (click)="pickerFin.open()" (keydown.enter)="pickerFin.open()" tabindex="0">access_time</mat-icon>
      </mat-form-field>
      <ngx-material-timepicker #pickerFin
                               [theme]="timePickerTheme"
                               [cancelBtnTmpl]="cancelBtn"
                               [confirmBtnTmpl]="confirmBtn">
      </ngx-material-timepicker>
      <div *ngIf="errors.hora_fin" class="invalid-feedback">{{ errors.hora_fin }}</div>

      <!-- Plantillas personalizadas para los botones del timepicker -->
      <ng-template #cancelBtn>
        <button mat-raised-button color="warn">Cancelar</button>
      </ng-template>
      <ng-template #confirmBtn>
        <button mat-raised-button color="primary">Confirmar</button>
      </ng-template>

      <!-- Lugar -->
      <mat-form-field class="mat-input" appearance="outline">
        <mat-label>Lugar</mat-label>
        <input matInput [(ngModel)]="evento.lugar" placeholder="Escribe el lugar del evento"
          (keypress)="soloLetrasYNumeros($event)">
      </mat-form-field>
      <div *ngIf="errors.lugar" class="invalid-feedback">{{ errors.lugar }}</div>

      <!-- Público objetivo (checkboxes - igual que materias en maestros) -->
      <div class="select-publico-objetivo">
        <div class="row mt-3 mb-3">
          <div class="form-group col-12">
            <label class="title-publico" for="publico_objetivo">Selecciona el público objetivo</label>
          </div>
        </div>
        <div class="checkbox-group" *ngFor="let publico of publicosObjetivo; let i = index">
          <mat-checkbox class="checkbox-item opc-sc"
                        name="opsc"
                        (change)="checkboxChange($event)"
                        [value]="publico.value"
                        [checked]="revisarSeleccion(publico.value)">
            <div class="d-checkbox-nombre">{{publico.nombre}}</div>
          </mat-checkbox>
        </div>
        <div *ngIf="errors.publico_objetivo" class="invalid-feedback">{{ errors.publico_objetivo }}</div>
      </div>

      <!-- Programa educativo (solo si público objetivo incluye estudiantes) -->
      <mat-form-field class="mat-input" appearance="outline" *ngIf="evento.publico_objetivo && evento.publico_objetivo.includes('Estudiantes')">
        <mat-label>Programa educativo</mat-label>
        <mat-select [(ngModel)]="evento.programa_educativo">
          <mat-option *ngFor="let programa of programasEducativos" [value]="programa.value">
            {{ programa.viewValue }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <div *ngIf="errors.programa_educativo" class="invalid-feedback">{{ errors.programa_educativo }}</div>

      <!-- Responsable del evento -->
      <mat-form-field class="mat-input" appearance="outline">
        <mat-label>Responsable del evento</mat-label>
        <mat-select [(ngModel)]="evento.responsable">
          <mat-option *ngFor="let responsable of responsables" [value]="responsable.id">
            {{ responsable.nombre_completo }} ({{ responsable.rol }})
          </mat-option>
        </mat-select>
      </mat-form-field>
      <div *ngIf="errors.responsable" class="invalid-feedback">{{ errors.responsable }}</div>

      <!-- Descripción breve -->
      <mat-form-field class="mat-input mat-hint-margin" appearance="outline">
        <mat-label>Descripción breve</mat-label>
        <textarea matInput [(ngModel)]="evento.descripcion" maxlength="300" rows="4"
          placeholder="Escribe una descripción breve del evento"></textarea>
        <mat-hint align="end">{{evento.descripcion?.length || 0}}/300</mat-hint>
      </mat-form-field>
      <div *ngIf="errors.descripcion" class="invalid-feedback">{{ errors.descripcion }}</div>

      <!-- Cupo máximo de asistentes -->
      <mat-form-field class="mat-input" appearance="outline">
        <mat-label>Cupo máximo de asistentes</mat-label>
        <input matInput [(ngModel)]="evento.cupo_maximo" placeholder="Escribe el cupo máximo"
          maxlength="3" (keypress)="soloNumeros($event)">
      </mat-form-field>
      <div *ngIf="errors.cupo_maximo" class="invalid-feedback">{{ errors.cupo_maximo }}</div>

      <!-- Botones -->
      <div class="section-buttons">
        <button class="btn btn-danger" (click)="regresar()">Cancelar</button>
        <button *ngIf="!editar" class="btn btn-primary" type="submit" (click)="registrar()">Registrar</button>
        <button *ngIf="editar" class="btn btn-primary" type="submit" (click)="actualizar()">Actualizar</button>
      </div>

    </div>
  </div>
</div>
